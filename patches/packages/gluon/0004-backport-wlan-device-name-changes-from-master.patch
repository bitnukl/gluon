From 28d47bd778d10470994f56d8b6ead8d982601c6f Mon Sep 17 00:00:00 2001
From: Matthias Schiffer <mschiffer@universe-factory.net>
Date: Sat, 24 Jan 2015 23:34:35 +0100
Subject: [PATCH] gluon-mesh-batman-adv-core: explicitly set WLAN client and
 mesh interfaces' ifname

---
 .../gluon/upgrade/mesh-batman-adv-core/invariant/020-wireless   | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git a/gluon/gluon-mesh-batman-adv-core/files/lib/gluon/upgrade/mesh-batman-adv-core/invariant/020-wireless b/gluon/gluon-mesh-batman-adv-core/files/lib/gluon/upgrade/mesh-batman-adv-core/invariant/020-wireless
index cf3a188..004483e 100755
--- a/gluon/gluon-mesh-batman-adv-core/files/lib/gluon/upgrade/mesh-batman-adv-core/invariant/020-wireless
+++ b/gluon/gluon-mesh-batman-adv-core/files/lib/gluon/upgrade/mesh-batman-adv-core/invariant/020-wireless
@@ -14,6 +14,16 @@
   uci:set('wireless', radio, 'country', site.regdom)
 
   local client = 'client_' .. radio
+  local mesh = 'mesh_' .. radio
+
+  local client_ifname
+  local mesh_ifname
+  local radio_suffix = radio:match('^radio(%d+)$')
+  if radio_suffix then
+    client_ifname = 'client' .. radio_suffix
+    mesh_ifname = 'mesh' .. radio_suffix
+  end
+
   uci:delete('wireless', client)
   uci:section('wireless', 'wifi-iface', client,
 	      {
@@ -22,10 +32,10 @@
 		ssid = 'Freifunk-Node startet...',
 		ssid_online = config.ssid,
 		macaddr = util.generate_mac(2, index),
+		ifname = client_ifname,		
 	      }
   )
 
-  local mesh = 'mesh_' .. radio
   uci:delete('network', mesh)
   uci:section('network', 'interface', mesh,
 	      {
@@ -45,6 +55,7 @@
 		bssid = config.mesh_bssid,
 		macaddr = util.generate_mac(3, index),
 		mcast_rate = config.mesh_mcast_rate,
+		ifname = mesh_ifname,
 	      }
   )
 end
